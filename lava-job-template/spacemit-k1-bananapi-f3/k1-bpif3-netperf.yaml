job_name: ${job_name}
timeouts:
  job:
    minutes: 10250
  action:
   minutes: 10249
  actions:
    power-off:
      seconds: 60
priority: medium
visibility: public
metadata:
  # please change these fields when modifying this job for your own tests.
  format: Lava-Test Test Definition 1.0
  name: spacemit-k1-bananapi-f3-test
  description: "test for spacemit-k1-bananapi-f3"
  version: "1.0"

protocols:
  lava-multinode:
    roles:
      server:
        device_type: spacemit-k1-bananapi-f3
        count: 1
        essential: True
        timeout:
          minutes: 30
      client:
        device_type: spacemit-k1-bananapi-f3
        count: 1
        timeout:
          minutes: 30

# ACTION_BLOCK
actions:
- command:
    role:
      - server
      - client
    name: pre_os_command
    timeout:
      minutes: 20
# DEPLOY_BLOCK
- deploy:
    role:
      - server
      - client
    timeout:
      minutes: 120
    to: tftp
    dtb:
      url: ${dtb_url}
    kernel:
      url: ${kernel_image_url}
      type: image
    ramdisk:
      url: ${ramdisk_url}
      install_overlay: False
      install_modules: False
    persistent_nfs:
      address: "{FILE_SERVER_IP}:{NFSROOTFS_PATH}"
- command:
    role:
      - server
      - client
    name: pxelinux_generate
    timeout:
      minutes: 20
# BOOT_BLOCK
- boot:
    role:
      - server
      - client
    timeout:
      minutes: 30
    method: minimal
    soft_reboot:
    - root
    - openEuler
    - reboot
    - The system will reboot now!
    prompts: ["root@openeuler-riscv64", "login:", "Password:"]
    auto_login:
      login_prompt: "(.*)openeuler-riscv64 login:(.*)"
      username: root
      password_prompt: "Password:"
      password: openEuler12#$
# TEST_BLOCK
- test:
    role:
      - server
    timeout:
      minutes: 10109
    definitions:
      - repository: ${testcase_repo}
        from: git
        name: ${testitem_name}
        path: ${testcase_path}
        parameters:
          PORT: ${port}

- test:
    role:
      - client
    timeout:
      minutes: 10109
    definitions:
      - repository: ${testcase_repo}
        from: git
        name: ${testitem_name}
        path: ${testcase_path}
        parameters:
          TIME: ${time}
          MSG_SIZE: ${msg_size}